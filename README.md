# 基于云原生技术的软件开发 - 大作业
## 1. 作业说明
   本次作业要求基于 Spring Boot 开发一个 REST 应用，并结合云原生技术栈（Docker、
   Kubernetes、Jenkins、Prometheus、Grafana）完成限流控制、持续集成部署、指标采集与扩容
   验证的全流程实践。
   ### 1.1. 功能开发（共 20 分，加分项 5 分）
   #### 1.1.1. 实现 REST 接口（5 分）
   实现一个简单的 REST API 接口（如 `/hello`），返回固定 JSON 数据：
   {"msg": "hello"}
   #### 1.1.2. 实现限流控制（10 分）
   要求接口支持限流功能：当请求频率超过每秒 100 次时，返回 HTTP 状态码 `429 Too Many
Requests`。
   限流实现方式不限，可选择：
   - 本地限流库（如：Guava RateLimiter、Bucket4j）
   ；
   - 使用 Spring Cloud Gateway 限流插件；
   - 自定义拦截器 + 原子计数器等。
   #### 1.1.3. 暴露访问指标给 Prometheus（5 分）
   应用需暴露接口访问频率（QPS）等指标，供 Prometheus 采集。Actuator + Micrometer 已自动
   统计 HTTP 请求，指标为：
```
# 某接口请求次数（已分状态码、方法等标签）
   http_server_requests_seconds_count
# 某接口响应时间总和（单位为秒）
http_server_requests_seconds_sum
```
#### 1.1.4. 加分项：统一限流机制（+5 分）
当服务部署多个副本（Pod）时，实现全局统一限流功能：当服务以多个副本（Pod）部署在
Kubernetes 中时，所有实例共享同一个限流策略，而不是每个实例独立计算。可以使用
Bucket4j + Redis 方案。
### 1.2. DevOps 流水线构建与部署（共 20 分，加分项 5 分）
#### 1.2.1. 编写 Dockerfile 构建镜像（5 分）
编写项目的 `Dockerfile`，构建出可运行的 Spring Boot 镜像，建议使用多阶段构建。
#### 1.2.2. 编写 Kubernetes YAML 文件（5 分）
准备以下资源对象的 YAML 文件：
-  Deployment（包含多个副本）
；
-  Service（暴露服务）
；
- ServiceMonitor 配置。
要求支持 imagePullPolicy、资源限制等规范配置项。
#### 1.2.3. 持续集成流水线（5 分）
编写 Jenkins CI 流水线脚本（`Jenkinsfile`），实现以下功能：
- 拉取代码；
- 构建项目（例如使用 Maven/Gradle）
；
- 运行至少一个单元测试；
- 构建并推送 Docker 镜像到镜像仓库。1.2.5. 加分项：代码提交自动触发流水线（+5 分）
配置 Git 仓库 Webhook，实现持续集成部署流水线的自动触发
### 1.3. 监控与弹性扩展实践（共 15 分，加分项 10 分）
#### 1.3.1. 采集 Prometheus 指标（5 分）
通过配置 ServiceMonitor，实现 Prometheus 对部署在 Kubernetes 中的 Spring Boot 应用的
/actuator/prometheus 指标采集。
#### 1.3.2. 配置 Grafana 监控面板（5 分）
在 Grafana 中创建自定义 Dashboard，包括：
- CPU 使用率；
- 内存使用率；
- JVM 指标（堆内存、线程数、GC 次数）；
- 请求 QPS、请求平均响应时间。
#### 1.3.3. 压测验证监控效果（5 分）
- 使用压测工具（或者自己写程序）对接口进行压测；
- 在 Grafana 面板中观察指标变化，并撰写简要说明（截图或指标分析）。
#### 1.3.4. 加分项：配置自动扩容（+10 分）
通过配置 Kubernetes 的 HPA（Horizontal Pod Autoscaler），基于负载指标（如请求 QPS）实现
应用实例的自动扩缩容。同时，结合压测工具和 Grafana 可视化展示扩容效果及系统响应过程。
## 2. 参考
   Pod 水平自动扩缩 | Kubernetes
   Rate Limiting a Spring API Using Bucket4j | Baeldung
## 3. 提交要求
   只需提交一份 PDF 项目说明文档，必须包含以下内容：
1. 组员信息，表格形式，姓名+学号+联系方式+个人贡献（在本次大作业内负责什么）。确保
   和分组登记上的信息一致
2. 限流功能相关的关键代码和说明（或注释）
3. 完整的 Dockerfile，K8s 编排文件，以及必要的说明（或注释）
4. 完整 Jenkins 持续集成、持续部署、持续测试配置文件与说明（或注释），以及后续验证流
   水线成功的截图
5. 监控指标采集的配置及说明；Grafana 监控大屏截图
6. 压测工具配置说明，及相应压测监控截图；K8s 手工扩容后，相应压测监控截图
   文档内容不限于以上所述，可以任意添加其余说明，使得文档更清晰
   注意：因为只会根据文档评分，文档一定要完整准确清晰地体现所做的工作。最好像一份教学
   用的说明文档，其他人可以根据你的文档逐步执行命令，并对照着你给的截图验证是否正确，
   最后完全复现你的结果。请大家对自己负责！
   统一提交 pdf 文件，统一文件命名，组号.pdf，如所在组为 1 组，则文件名为：1.pdf
   ⚠️ 每组只需要提交一份。最好是组长提交，如果组长无法提交，也可以组员代交。
   ⚠️ 截止前允许多次提交，但只会按照最新一次提交进行评分。
## 4. 分组
   ### 4.1. 分组方式
   自由组合，三人一组（也可以一个人或者两个人一个小组），跟助教登记，后期账号会按照小
   组生成和发放。
   ### 4.2. 分组登记
   请联系老师。
   ### 4.3. 分组截止时间
   2025 年 7 月 4 日 24:00。截止时间之前，分组（成员）可以随意修改，截止时间结束后，不
   再接受修改。
## 5. 提交方式
   文档，包含关键步骤以及截图，发邮件到：grissom.wang@transwarp.io
   ✨邮件标题格式：“小组编号-云原生-第三次作业”，使用减号“-”作为分隔符。
   例如：nju01 小组，则邮件标题为 “nju01-云原生-第三次作业”
   ⚠️ 如果邮件标题格式不对，有概率无法收到作业
   请在邮件中注明小组成员以及成员分工
   提交截止时间
   2025 年 7 月 25 日 24:00